---
- name: Install Jenkins on Centos
  hosts: jenkins
  become: yes

  tasks:
    - name: Install java jdk 11 on Centos 8
      dnf:
        name: java-11-openjdk-devel.x86_64
        state: present
      when: ansible_facts['os_family'] == 'RedHat' and ansible_facts['distribution_major_version'] == '8'

    - name: Enable EPEL Repository on CentOS 8
      dnf:
        name: epel-release
        state: latest
        # become: yes
      when: 
        ansible_facts['os_family'] == 'RedHat' and ansible_facts['distribution_major_version'] == '8'
    
    - name: Enable EPEL Repository on CentOS 7
      yum:
        name: epel-release
        state: latest
        # become: yes
      when: ansible_facts['os_family'] == 'RedHat' and ansible_facts['distribution_major_version'] == '7'


    - name: Download jenkins repo file
      get_url:
        url: http://pkg.jenkins-ci.org/redhat-stable/jenkins.repo
        dest: /etc/yum.repos.d/jenkins.repo
    
    - name: Add jenkins rpm key
      rpm_key:
        state: present
        key: https://pkg.jenkins.io/redhat/jenkins.io.key

    - name: Install Jenkins on Centos 8
      dnf: 
        name: jenkins
        state: present
        # become: yes
      when: ansible_facts['os_family'] == 'RedHat' and ansible_facts['distribution_major_version'] == '8'

    - name: Start jenkins service
      service:
        name: jenkins
        state: restarted
    #   become: yes
      
    - name: Enable jenkins service on server reboot
      service:
        name: jenkins
        enabled: yes
    #   become: yes
      
    - name: Allow jenkins service through firewall
      firewalld:
        port: "8080/tcp"
        permanent: yes
        state: enabled
    #   become: yes

    - name: reload firewalld service
      systemd:
        name: firewalld
        state: reloaded
    #   become: yes
      
